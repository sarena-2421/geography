<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>108Ë™≤Á∂±Â≠∏Ê∏¨Âú∞ÁêÜÊ®°Êì¨App</title>
    <!-- ÂºïÂÖ• React Âíå ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- ÂºïÂÖ• Babel Áî®ÊñºËß£Êûê JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- ÂºïÂÖ• Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ÂºïÂÖ• Font Awesome (Áî®ÊñºÂú∞ÁêÜÁâπÂÆöÂúñÊ®ô) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Serif+TC:wght@600&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .font-serif { font-family: 'Noto Serif TC', serif; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-slide-in-right { animation: slideInRight 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Âú∞ÁêÜÂú∞ÂúñÁ¥ãÁêÜËÉåÊôØ */
        .bg-geo-pattern {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="bg-stone-100 h-screen w-full flex justify-center items-center overflow-hidden">
    <div id="root" class="w-full h-full max-w-md bg-white shadow-2xl relative flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // -----------------------------------------------------------------------------
        // 0. ÂÖßÂª∫ÂúñÊ®ôÂÖÉ‰ª∂ (‰ΩøÁî® FontAwesome Êàñ SVG)
        // -----------------------------------------------------------------------------
        const Icons = {
            Globe: (props) => <i className={`fa-solid fa-earth-americas ${props.className}`} style={{fontSize: props.size}}></i>,
            Mountain: (props) => <i className={`fa-solid fa-mountain-sun ${props.className}`} style={{fontSize: props.size}}></i>,
            City: (props) => <i className={`fa-solid fa-city ${props.className}`} style={{fontSize: props.size}}></i>,
            // FIX: Rename Map to MapIcon to avoid conflict with native Map object
            MapIcon: (props) => <i className={`fa-solid fa-map-location-dot ${props.className}`} style={{fontSize: props.size}}></i>,
            Satellite: (props) => <i className={`fa-solid fa-satellite ${props.className}`} style={{fontSize: props.size}}></i>,
            
            // UI Icons
            Home: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||20} height={props.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Grid: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||20} height={props.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            Flag: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||20} height={props.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>,
            ChevronLeft: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||20} height={props.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m15 18-6-6 6-6"/></svg>,
            ChevronRight: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||20} height={props.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m9 18 6-6-6-6"/></svg>,
            Award: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||20} height={props.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>,
            XCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||20} height={props.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>,
            RotateCcw: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||20} height={props.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Compass: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||20} height={props.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>,
            Tag: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||20} height={props.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94 .94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></svg>
        };

        const { Globe, Mountain, City, MapIcon, Satellite, Home, Grid, Flag, ChevronLeft, ChevronRight, Award, XCircle, RotateCcw, Compass, Tag } = Icons;

        // -----------------------------------------------------------------------------
        // 1. ÁúüÂØ¶È°åÂ∫´ÁØÑ‰æã (Real Questions - Geography)
        // -----------------------------------------------------------------------------
        const REAL_QUESTION_EXAMPLES = [
            {
                id: 'real_geo_1',
                type: 'single',
                category: 'Ëá™ÁÑ∂Âú∞ÁêÜ',
                text: 'Âè∞ÁÅ£ÊüêÊ≤≥ÊµÅÂÖ∑Êúâ„ÄåËçíÊ∫™Âûã„ÄçÁöÑÁâπÊÄßÔºåÊµÅÈáèË±êÊûØËÆäÂåñÊ•µÂ§ß„ÄÇË´ãÂïèÈÄ†ÊàêÊ≠§ÁèæË±°ÁöÑ‰∏ªË¶ÅÊ∞£ÂÄôÂõ†Á¥†ÁÇ∫‰ΩïÔºü',
                options: [
                    'ÈôçÊ∞¥Â≠£ÁØÄÂàÜ‰Ωà‰∏çÂùá',
                    'Âπ¥ÈôçÊ∞¥ÈáèÈÅéÂ∞ë',
                    'Ëí∏ÁôºÈáèÂ§ßÊñºÈôçÊ∞¥Èáè',
                    'Ê∞£Ê∫´Âπ¥ËºÉÂ∑ÆÂ§ß'
                ],
                correctAnswer: [0],
                explanation: 'Âè∞ÁÅ£Ê≤≥Â∑ùÂ§öÂ±¨ËçíÊ∫™ÂûãÔºå‰∏ªÂõ†ÊòØÈôçÊ∞¥È´òÂ∫¶ÈõÜ‰∏≠ÊñºÂ§èÂ≠£ÔºàÊ¢ÖÈõ®„ÄÅÈ¢±È¢®ÔºâÔºåÂÜ¨Â≠£ÂâáÁõ∏Â∞ç‰πæÊó±ÔºåÂ∞éËá¥Ê≤≥Â∑ùÊµÅÈáèË±êÊûØÊá∏ÊÆä„ÄÇ',
                difficulty: 'Êòì'
            },
            {
                id: 'real_geo_2',
                type: 'single',
                category: '‰∫∫ÊñáÂú∞ÁêÜ',
                text: 'ÊüêË∑®ÂúãÊàêË°£ÂÖ¨Âè∏ËÄÉÈáèÁîüÁî¢ÊàêÊú¨ÔºåÂ∞áÂ∑•Âª†Ë®≠Âú®Ë∂äÂçó„ÄÅÂ≠üÂä†ÊãâÁ≠âÂú∞„ÄÇÊ≠§Á®ÆÂçÄ‰ΩçÈÅ∏Êìá‰∏ªË¶ÅÂèó‰∏ãÂàó‰ΩïÁ®ÆÂ∑•Ê•≠ÂçÄ‰ΩçÂõ†Á¥†ÂΩ±ÈüøÔºü',
                options: [
                    'ÂãûÂäõ',
                    'ÂãïÂäõ',
                    'ÂéüÊñô',
                    'Â∏ÇÂ†¥'
                ],
                correctAnswer: [0],
                explanation: 'Á¥°ÁπîÊàêË°£Ê•≠Â±¨ÊñºÂãûÂäõÂØÜÈõÜÁî¢Ê•≠ÔºåË∂äÂçó„ÄÅÂ≠üÂä†ÊãâÊìÅÊúâÂ§ßÈáè‰∏îÁõ∏Â∞ç‰ΩéÂªâÁöÑÂãûÂãïÂäõÔºåÂõ†Ê≠§Âê∏ÂºïË∑®Âúã‰ºÅÊ•≠Ë®≠Âª†„ÄÇ',
                difficulty: 'Êòì'
            },
            {
                id: 'real_geo_3',
                type: 'single',
                category: 'Âú∞ÁêÜÊäÄË°ì',
                text: 'Ëã•Ë¶ÅÂàÜÊûêÊüêÂú∞ÂçÄÂù°Â∫¶Â§ßÊñº30%‰∏îÂêåÊôÇÂ±¨ÊñºÂúüÁü≥ÊµÅÊΩõÂã¢ÂçÄÁöÑÁØÑÂúçÔºåÂà©Áî®Âú∞ÁêÜË≥áË®äÁ≥ªÁµ±ÔºàGISÔºâÈÄ≤Ë°åÂàÜÊûêÊôÇÔºåÊúÄÈÅ©Âêà‰ΩøÁî®‰∏ãÂàóÂì™‰∏ÄÈ†ÖÁñäÂúñÂäüËÉΩÔºü',
                options: [
                    '‰∫§ÈõÜ (Intersect)',
                    'ËÅØÈõÜ (Union)',
                    'Áí∞Âüü (Buffer)',
                    'Ë¶ñÂüü (Viewshed)'
                ],
                correctAnswer: [0],
                explanation: 'Ë¶ÅÊâæÂá∫„ÄåÂêåÊôÇÁ¨¶Âêà„ÄçÂÖ©ÂÄãÊ¢ù‰ª∂ÔºàÂù°Â∫¶>30% AND ÂúüÁü≥ÊµÅÊΩõÂã¢ÂçÄÔºâÁöÑÂçÄÂüüÔºåÊáâ‰ΩøÁî®ÁñäÂúñÂàÜÊûê‰∏≠ÁöÑ„Äå‰∫§ÈõÜ„ÄçÂäüËÉΩ„ÄÇ',
                difficulty: '‰∏≠'
            },
            {
                id: 'real_geo_4',
                type: 'group',
                category: 'Ê∑∑ÂêàÈ°å (Ê∞£ÂÄôËÆäÈÅ∑)',
                passageTitle: 'ÂÖ®ÁêÉÊöñÂåñËàáÊ•µÁ´ØÊ∞£ÂÄô',
                passageContent: `ËøëÂπ¥‰æÜÔºåÂÖ®ÁêÉÂπ≥ÂùáÊ∞£Ê∫´ÊåÅÁ∫å‰∏äÂçáÔºåÂ∞éËá¥Ê•µÂú∞ÂÜ∞Â±§ËûçÂåñ„ÄÅÊµ∑Âπ≥Èù¢‰∏äÂçá„ÄÇÂêåÊôÇÔºåÊ•µÁ´ØÂ§©Ê∞£‰∫ã‰ª∂ÔºàÂ¶ÇÂº∑ÈôçÈõ®„ÄÅ‰πæÊó±„ÄÅÁÜ±Êµ™ÔºâÁôºÁîüÁöÑÈ†ªÁéáËàáÂº∑Â∫¶‰πüÈ°ØËëóÂ¢ûÂä†„ÄÇÊüêÊµ∑Â≥∂ÂúãÂÆ∂Èù¢Ëá®ÂúãÂúüË¢´Ê∑πÊ≤íÁöÑÂç±Ê©üÔºåÊ≠£Â∞ãÊ±ÇÂúãÈöõÊè¥Âä©„ÄÇ`,
                questions: [
                    {
                        id: 'real_geo_4_1',
                        type: 'single',
                        text: '‰∏ãÂàó‰ΩïÁ®ÆÊ∞£È´îÊòØÈÄ†Êàê‰∏äËø∞ÁèæË±°ÊúÄ‰∏ªË¶ÅÁöÑ‰∫∫ÁÇ∫Ê∫´ÂÆ§Ê∞£È´îÔºü',
                        options: [
                            '‰∫åÊ∞ßÂåñÁ¢≥ (CO2)',
                            'Áî≤ÁÉ∑ (CH4)',
                            'Ê∞ßÂåñ‰∫ûÊ∞Æ (N2O)',
                            'Ëá≠Ê∞ß (O3)'
                        ],
                        correctAnswer: [0],
                        explanation: 'ÈõñÁÑ∂Áî≤ÁÉ∑ÁöÑÊ∫´ÂÆ§ÊïàÊáâÊΩõÂã¢ËºÉÈ´òÔºå‰ΩÜ‰ª•ÊéíÊîæÁ∏ΩÈáèÂèäÂ∞çÂÖ®ÁêÉÊöñÂåñÁöÑË≤¢ÁçªÂ∫¶ËÄåË®ÄÔºå‰∫åÊ∞ßÂåñÁ¢≥ÊòØÊúÄ‰∏ªË¶ÅÁöÑ‰∫∫ÁÇ∫Ê∫´ÂÆ§Ê∞£È´î„ÄÇ',
                        difficulty: 'Êòì'
                    },
                    {
                        id: 'real_geo_4_2',
                        type: 'single',
                        text: 'Êµ∑Âπ≥Èù¢‰∏äÂçáÂ∞çÂè∞ÁÅ£Ë•øÂçóÊ≤øÊµ∑Âú∞ÂçÄÊúÄÁõ¥Êé•ÁöÑË°ùÊìäÁÇ∫‰ΩïÔºü',
                        options: [
                            'ÂúüÂ£§ÈπΩÂåñËàáÂú∞Â±§‰∏ãÈô∑Âä†Âäá',
                            'Ê≤ôÂ°µÊö¥È†ªÁéáÂ¢ûÂä†',
                            'Ê≤≥Â∑ùÂêëÊ∫ê‰æµËùï‰ΩúÁî®Â¢ûÂº∑',
                            'ÁèäÁëöÁ§ÅÁôΩÂåñÁØÑÂúçÊì¥Â§ß'
                        ],
                        correctAnswer: [0],
                        explanation: 'Êµ∑Âπ≥Èù¢‰∏äÂçáÊúÉÂ∞éËá¥Êµ∑Ê∞¥ÂÄíÁÅåÔºåÂä†ÂäáÊ≤øÊµ∑‰ΩéÁ™™Âú∞ÂçÄÁöÑÊ∑πÊ∞¥„ÄÅÂúüÂ£§ÈπΩÂåñÂïèÈ°åÔºåËã•ÈÖçÂêàË∂ÖÊäΩÂú∞‰∏ãÊ∞¥ÔºåÂú∞Â±§‰∏ãÈô∑ÂçÄÂ∞áÊõ¥ÊòìÁ©çÊ∞¥‰∏çÈÄÄ„ÄÇ',
                        difficulty: '‰∏≠'
                    }
                ]
            }
        ];

        // -----------------------------------------------------------------------------
        // 2. Âú∞ÁêÜÈ°åÂ∫´Áî¢ÁîüÂô®Ë≥áÊñôÂ∫´ (Geography Database)
        // -----------------------------------------------------------------------------

        // Ëá™ÁÑ∂Âú∞ÁêÜÊ®°ÁµÑ (Physical Geography)
        const PHY_CONCEPTS = [
            { topic: 'ÊùøÂ°äÈÅãÂãï', q: '‰ΩçÊñºÁí∞Â§™Âπ≥Ê¥ãÁÅ´Â±±Âú∞ÈúáÂ∏∂‰∏äÁöÑÂúãÂÆ∂ÔºåÊúÄÂÆπÊòìË¶ãÂà∞Âì™Á®ÆÂú∞ÂΩ¢ÊôØËßÄÔºü', ans: 'ÁÅ´Â±±ËàáË§∂Êõ≤Â±±ËÑà', opts: ['Âª£Â§ßÁöÑË°ùÁ©çÂπ≥Âéü', 'Âè§ËÄÅÁöÑÂú∞Áõæ', 'ÂÜ∞ËùïÊπñÊ≥ä'] },
            { topic: 'Ê∞£ÂÄôÈ°ûÂûã', q: 'ÈóúÊñº„ÄåÂú∞‰∏≠Êµ∑ÂûãÊ∞£ÂÄô„ÄçÁöÑÊïòËø∞Ôºå‰∏ãÂàó‰ΩïËÄÖÊ≠£Á¢∫Ôºü', ans: 'Â§è‰πæÂÜ¨Èõ®', opts: ['ÂÖ®Âπ¥ÊúâÈõ®', 'Â§èÈõ®ÂÜ¨‰πæ', 'ÂÖ®Âπ¥‰πæÁá•Â∞ëÈõ®'] },
            { topic: 'Ê≤≥ÊµÅÂú∞ÂΩ¢', q: 'Ê≤≥ÊµÅÂá∫Êµ∑Âè£Ëã•Âõ†Ê≥•Ê≤ôÂ†ÜÁ©çÈáèÂ§ßÊñºÊ≥¢Êµ™‰æµËùïÈáèÔºåÊúÄÂÆπÊòìÂΩ¢Êàê‰ΩïÁ®ÆÂú∞ÂΩ¢Ôºü', ans: '‰∏âËßíÊ¥≤', opts: ['Ê≤ñÁ©çÊâá', 'Ê∞æÊø´Âπ≥Âéü', 'Ê≤≥Èöé'] },
            { topic: 'ÂúüÂ£§ÊàêÂõ†', q: 'Âú®È´òÊ∫´Â§öÈõ®ÁöÑÁÜ±Â∏∂Èõ®ÊûóÂçÄÔºåÂúüÂ£§Ê∑ãÊ∫∂‰ΩúÁî®Êó∫ÁõõÔºåÂÆπÊòìÂΩ¢Êàê‰ΩïÁ®ÆÈ°èËâ≤ÁöÑÂúüÂ£§Ôºü', ans: 'Á¥ÖÂúü (Á£öÁ¥ÖÂ£§)', opts: ['ÈªëÂúü (ÈªëÈà£Âúü)', 'ÁÅ∞ÂåñÂúü', 'ÈªÉÂúü'] },
            { topic: 'Ê¥ãÊµÅÁ≥ªÁµ±', q: 'ÂåóÂ§ßË•øÊ¥ãÊöñÊµÅÂ∞çË•øÊ≠êÊ∞£ÂÄôÁöÑ‰∏ªË¶ÅÂΩ±ÈüøÁÇ∫‰ΩïÔºü', ans: 'Â¢ûÊ∫´Â¢ûÊøï', opts: ['ÈôçÊ∫´Ê∏õÊøï', 'Â¢ûÊ∫´Ê∏õÊøï', 'ÈôçÊ∫´Â¢ûÊøï'] },
            { topic: 'ÂÜ∞Ê≤≥Âú∞ÂΩ¢', q: 'UÂûãË∞∑ÔºàÂÜ∞ËùïÊßΩÔºâ‰∏ªË¶ÅÊòØÁî±‰ΩïÁ®ÆÁáüÂäõ‰ΩúÁî®ÂΩ¢ÊàêÔºü', ans: 'ÂÜ∞Ê≤≥‰æµËùï', opts: ['Ê≤≥ÊµÅ‰æµËùï', 'È¢®Âäõ‰æµËùï', 'Êµ∑Ê∞¥‰æµËùï'] }
        ];

        // ‰∫∫ÊñáÂú∞ÁêÜÊ®°ÁµÑ (Human Geography)
        const HUM_CONCEPTS = [
            { topic: '‰∫∫Âè£ËΩâÂûã', q: 'Âú®‰∫∫Âè£ËΩâÂûãÊ®°ÂºèÁöÑ„ÄåÈ´òÁ©©ÂÆöÈöéÊÆµ„ÄçÔºåÂÖ∂Âá∫ÁîüÁéáËàáÊ≠ª‰∫°ÁéáÁöÑÁâπÂæµÁÇ∫‰ΩïÔºü', ans: 'È´òÂá∫ÁîüÁéá„ÄÅÈ´òÊ≠ª‰∫°Áéá', opts: ['È´òÂá∫ÁîüÁéá„ÄÅ‰ΩéÊ≠ª‰∫°Áéá', '‰ΩéÂá∫ÁîüÁéá„ÄÅ‰ΩéÊ≠ª‰∫°Áéá', '‰ΩéÂá∫ÁîüÁéá„ÄÅÈ´òÊ≠ª‰∫°Áéá'] },
            { topic: 'ÈÉΩÂ∏ÇÈöéÂ±§', q: '‰æùÁÖß‰∏≠Âú∞ÁêÜË´ñÔºåÈ´òÁ¥ö‰∏≠Âú∞Ëàá‰ΩéÁ¥ö‰∏≠Âú∞ÁöÑÊØîËºÉÔºå‰∏ãÂàó‰ΩïËÄÖÊ≠£Á¢∫Ôºü', ans: 'È´òÁ¥ö‰∏≠Âú∞Êï∏ÈáèËºÉÂ∞ëÔºåÊúçÂãôÁØÑÂúçËºÉÂ§ß', opts: ['È´òÁ¥ö‰∏≠Âú∞Êï∏ÈáèËºÉÂ§öÔºåÊúçÂãôÁØÑÂúçËºÉÂ∞è', 'ÂÖ©ËÄÖÊï∏ÈáèÁõ∏Âêå', '‰ΩéÁ¥ö‰∏≠Âú∞Êèê‰æõÁöÑÂïÜÂìÅÁ®ÆÈ°ûËºÉÂ§ö'] },
            { topic: 'Ëæ≤Ê•≠ÂçÄ‰Ωç', q: 'ÈÇ±ÂøµÂúàÔºàThunenÔºâÊ®°Âºè‰∏≠ÔºåÊúÄÈù†ËøëÂ∏ÇÂ†¥‰∏≠ÂøÉÁöÑËæ≤Ê•≠Ê¥ªÂãïÈÄöÂ∏∏ÊòØÔºü', ans: 'ÂúíËóùËæ≤Ê•≠ (ÈÖ™Ëæ≤„ÄÅËî¨Êûú)', opts: ['ÊîæÁâßÊ•≠', 'Â∞èÈ∫•Á®ÆÊ§ç', 'ÊûóÊ•≠'] },
            { topic: 'Â∑•Ê•≠ÂçÄ‰Ωç', q: 'Èüã‰ºØ (Weber) ÁöÑÂ∑•Ê•≠ÂçÄ‰ΩçÁêÜË´ñ‰∏ªË¶ÅÂº∑Ë™ø‰∏ãÂàóÂì™È†ÖÊàêÊú¨ÁöÑÊúÄÂ∞èÂåñÔºü', ans: 'ÈÅãËº∏ÊàêÊú¨', opts: ['ÂãûÂ∑•ÊàêÊú¨', 'ÈõÜËÅöÁ∂ìÊøü', 'ÂúüÂú∞ÊàêÊú¨'] },
            { topic: 'ÂÖ®ÁêÉÂåñ', q: 'Ë∑®Âúã‰ºÅÊ•≠Âú®ÂÖ®ÁêÉÈÄ≤Ë°åÁ©∫ÈñìÂàÜÂ∑•ÔºåÈÄöÂ∏∏Â∞áÁ†îÁôº‰∏≠ÂøÉË®≠Âú®ÊØçÂúãÊàñÊ†∏ÂøÉÂúãÂÆ∂Ôºå‰∏ªË¶ÅÊòØËÄÉÈáèÔºü', ans: 'È´òÁ¥†Ë≥™ÁöÑ‰∫∫ÂäõË≥áÊ∫êËàáÊäÄË°ì', opts: ['‰ΩéÂªâÁöÑÂúüÂú∞ÊàêÊú¨', 'Ë±êÂØåÁöÑÂ§©ÁÑ∂Ë≥áÊ∫ê', 'ÂØ¨È¨ÜÁöÑÁí∞‰øùÊ≥ïË¶è'] }
        ];

        // ÂçÄÂüüÂú∞ÁêÜÊ®°ÁµÑ (Regional Geography)
        const REG_CONCEPTS = [
            { topic: 'Âè∞ÁÅ£Âú∞ÂΩ¢', q: 'Âè∞ÁÅ£Âú∞ÂΩ¢‰∏ªÈ´îÈ™®ÂππÊòØÂì™‰∏ÄÂ∫ßÂ±±ËÑàÔºü', ans: '‰∏≠Â§ÆÂ±±ËÑà', opts: ['Èõ™Â±±Â±±ËÑà', 'ÁéâÂ±±Â±±ËÑà', 'Êµ∑Â≤∏Â±±ËÑà'] },
            { topic: 'Êù±Âçó‰∫ûÊñáÂåñ', q: 'Êù±Âçó‰∫ûÂú∞ÂçÄÂÆóÊïô‰ø°‰ª∞Â§öÂÖÉÔºåÂÖ∂‰∏≠Ëè≤ÂæãË≥ì‰∏ªË¶Å‰ø°‰ª∞‰ΩïÁ®ÆÂÆóÊïôÔºü', ans: 'Â§©‰∏ªÊïô', opts: ['‰ºäÊñØËò≠Êïô', '‰ΩõÊïô', 'Âç∞Â∫¶Êïô'] },
            { topic: 'ÂåóÁæéËæ≤Ê•≠', q: 'ÁæéÂúã‰∏≠Ë•øÈÉ®ËëóÂêçÁöÑ„ÄåÁéâÁ±≥Â∏∂„ÄçËàá„Äå‰π≥ÈÖ™Â∏∂„ÄçÔºåÂÖ∂ÂàÜ‰Ωà‰∏ªË¶ÅÂèó‰ΩïÁ®ÆÂõ†Á¥†ÂΩ±ÈüøÔºü', ans: 'Ê∞£ÂÄôÊ¢ù‰ª∂', opts: ['Á§¶Áî¢ÂàÜ‰Ωà', 'ÊîøÊ≤ªÁïåÁ∑ö', 'Á®ÆÊóèÂàÜ‰Ωà'] },
            { topic: 'ÈùûÊ¥≤ÁôºÂ±ï', q: 'Ëñ©Ëµ´ÁàæÂú∞ÂçÄ (Sahel) Èï∑ÊúüÈù¢Ëá®Âö¥ÈáçÁöÑÁí∞Â¢ÉÂïèÈ°åÔºå‰∏ªË¶ÅÊòØÔºü', ans: 'Ê≤ôÊº†Âåñ', opts: ['ÈÖ∏Èõ®', 'Ê∞∏ÂáçÂúüËûçÂåñ', 'ÁÅ´Â±±ÁàÜÁôº'] },
            { topic: 'Ê≠êÊ¥≤ËÅØÁõü', q: 'Ê≠êÁõüÊàêÁ´ãÁöÑ‰∏ªË¶ÅÁõÆÊ®ô‰πã‰∏ÄÔºåÊòØÈÄèÈÅéÂì™Á®ÆÊñπÂºè‰øÉÈÄ≤ÊúÉÂì°ÂúãÈñìÁöÑÁ∂ìÊøüÊï¥ÂêàÔºü', ans: 'Ê∂àÈô§ÈóúÁ®ÖÂ£ÅÂ£ò', opts: ['Áµ±‰∏ÄË™ûË®Ä', 'Âª∫Á´ãÂñÆ‰∏ÄÂÆóÊïô', 'Âª¢Èô§ÂêÑÂúãËªçÈöä'] }
        ];

        // Âú∞ÁêÜÊäÄË°ìÊ®°ÁµÑ (Geographic Techniques)
        const TECH_CONCEPTS = [
            { topic: 'Âú∞ÂúñÊäïÂΩ±', q: 'Ëã•Ë¶ÅÁπ™Ë£Ω‰∏ñÁïåËà™Êµ∑ÂúñÔºåÊúÄÈÅ©Âêà‰ΩøÁî®Âì™Á®ÆÊäïÂΩ±Ê≥ïÔºå‰ª•Á¢∫‰øùÊñπÂêëÊ≠£Á¢∫Ôºü', ans: 'È∫•Âç°ÊâòÊäïÂΩ±', opts: ['Ëé´ÁàæÂ®ÅÊäïÂΩ±', 'Ëò≠‰ºØÁâπÊäïÂΩ±', 'ÁæÖË≥ìÊ£ÆÊäïÂΩ±'] },
            { topic: 'GISË≥áÊñôÊ®°Âºè', q: 'Âú®GIS‰∏≠ÔºåÂà©Áî®Á∂≤Ê†º (Grid) ‰æÜÂÑ≤Â≠òË≥áÊñôÔºåÈÅ©ÂêàË°®Áèæ‰∏ãÂàóÂì™Á®ÆÂú∞ÁêÜÁèæË±°Ôºü', ans: 'Âú∞ÂΩ¢È´òÁ®ã (DEM)', opts: ['ÈÅìË∑ØÁ∂≤Áµ°', 'Ë°åÊîøÂçÄÁïåÁ∑ö', 'ÈõªÁ∑öÊ°ø‰ΩçÁΩÆ'] },
            { topic: 'GPSÊáâÁî®', q: 'GPSÂÖ®ÁêÉÂÆö‰ΩçÁ≥ªÁµ±ÊúÄ‰∏ªË¶ÅÁöÑÂäüËÉΩÊòØÊèê‰æõ‰ªÄÈ∫ºË≥áË®äÔºü', ans: '‰∏âÁ∂≠ÂùêÊ®ôËàáÊôÇÈñì', opts: ['Âú∞Ë°®Ê∫´Â∫¶', 'Ê§çË¢´Ë¶ÜËìãÁéá', 'ÂúüÂ£§ÊøïÂ∫¶'] },
            { topic: 'ÈÅôÊ∏¨ÊäÄË°ì', q: 'Âà©Áî®Ë°õÊòüÂΩ±ÂÉè‰æÜÁõ£Ê∏¨‰∫ûÈ¶¨ÈÅúÈõ®ÊûóÁöÑÁ†ç‰ºêÁãÄÊ≥ÅÔºåÊòØÂ±¨ÊñºÂì™Á®ÆÂú∞ÁêÜÊäÄË°ìÁöÑÊáâÁî®Ôºü', ans: 'ÈÅôÊ∏¨ (RS)', opts: ['ÂÖ®ÁêÉÂÆö‰ΩçÁ≥ªÁµ± (GPS)', 'Âú∞ÂúñÁπ™Ë£Ω', 'ÂØ¶Âú∞ËÄÉÂØü'] },
            { topic: 'Á≠âÈ´òÁ∑öÂà§ËÆÄ', q: 'Âú®Á≠âÈ´òÁ∑öÂú∞ÂΩ¢Âúñ‰∏äÔºåËã•Á≠âÈ´òÁ∑öÂêëÈ´òËôïÂá∏Âá∫ÔºàVÂ≠óÂ∞ñÁ´ØÊåáÂêëÈ´òËôïÔºâÔºå‰ª£Ë°®Ë©≤Âú∞ÁÇ∫‰ΩïÁ®ÆÂú∞ÂΩ¢Ôºü', ans: 'Ê≤≥Ë∞∑', opts: ['Â±±ËÑä', 'Â±±È†Ç', 'ÈûçÈÉ®'] }
        ];

        // -----------------------------------------------------------------------------
        // Helper: Fisher-Yates Shuffle
        // -----------------------------------------------------------------------------
        const fisherYatesShuffle = (array) => {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        };

        // -----------------------------------------------------------------------------
        // Generator Logic
        // -----------------------------------------------------------------------------
        const generateGeographyMock = (category, itemIndex, variantCount) => {
            const shuffle = (arr) => [...arr].sort(() => 0.5 - Math.random());
            const isReview = variantCount > 0;
            const reviewLabel = isReview ? '„Äêüí°ËßÄÂøµË§áÁøí„Äë' : '';

            let db, icon, colorClass, categoryName;

            switch(category) {
                case 'phy': 
                    db = PHY_CONCEPTS; 
                    icon = <Icons.Mountain size={16} />; 
                    colorClass = "text-emerald-700 bg-emerald-100";
                    categoryName = "Ëá™ÁÑ∂Âú∞ÁêÜ";
                    break;
                case 'hum': 
                    db = HUM_CONCEPTS; 
                    icon = <Icons.City size={16} />; 
                    colorClass = "text-orange-700 bg-orange-100";
                    categoryName = "‰∫∫ÊñáÂú∞ÁêÜ";
                    break;
                case 'reg': 
                    db = REG_CONCEPTS; 
                    icon = <Icons.Globe size={16} />; 
                    colorClass = "text-sky-700 bg-sky-100";
                    categoryName = "ÂçÄÂüüÂú∞ÁêÜ";
                    break;
                case 'tech': 
                    db = TECH_CONCEPTS; 
                    icon = <Icons.Satellite size={16} />; 
                    colorClass = "text-indigo-700 bg-indigo-100";
                    categoryName = "Âú∞ÁêÜÊäÄË°ì";
                    break;
            }

            const item = db[itemIndex % db.length];
            const distractors = shuffle(item.opts);
            
            // ËÆäÈ´îÈÇèËºØÔºöË§áÁøíÈ°å‰øÆÊîπÂïèÊ≥ï
            let qText = item.q;
            if (isReview) {
                const variants = [
                    str => `(ËßÄÂøµÂº∑Âåñ) ${str}`,
                    str => str.replace('‰∏ãÂàó‰ΩïËÄÖ', 'Ë´ãÂà§Êñ∑‰ΩïËÄÖ'),
                    str => str.includes('ÁÇ∫‰Ωï') ? str.replace('ÁÇ∫‰Ωï', '‰∏ªË¶ÅÂéüÂõ†ÊòØ‰ªÄÈ∫º') : `ÈáùÂ∞ç„Äå${item.topic}„ÄçÊ¶ÇÂøµÔºå${str}`
                ];
                qText = variants[variantCount % variants.length](qText);
            }

            return {
                category: categoryName,
                text: `${reviewLabel} [${item.topic}] ${qText}`,
                options: [item.ans, ...distractors],
                explanation: `Ê≠£Á¢∫Á≠îÊ°àÁÇ∫„Äå${item.ans}„Äç„ÄÇÊú¨È°åÊ∏¨È©óÈáçÈªûÁÇ∫Ôºö${item.topic}„ÄÇ`,
                correctIndex: 0,
                isReview,
                colorClass,
                icon
            };
        };

        const generateMockQuestions = (startId, count) => {
            const mocks = [];
            const categories = ['phy', 'hum', 'reg', 'tech'];
            let taskPool = [];
            
            // Ë®àÁÆóÁ∏ΩÂü∫Á§éÈ°åÊï∏
            const totalBaseItems = PHY_CONCEPTS.length + HUM_CONCEPTS.length + REG_CONCEPTS.length + TECH_CONCEPTS.length;
            const loopsNeeded = Math.ceil(count / totalBaseItems) + 1;

            for (let loop = 0; loop < loopsNeeded; loop++) {
                categories.forEach(cat => {
                    let len = 0;
                    if(cat === 'phy') len = PHY_CONCEPTS.length;
                    if(cat === 'hum') len = HUM_CONCEPTS.length;
                    if(cat === 'reg') len = REG_CONCEPTS.length;
                    if(cat === 'tech') len = TECH_CONCEPTS.length;

                    for (let i = 0; i < len; i++) {
                        taskPool.push({ cat, itemIndex: i, variantCount: loop });
                    }
                });
            }

            taskPool = fisherYatesShuffle(taskPool);
            const selectedTasks = taskPool.slice(0, count);

            selectedTasks.forEach((task, i) => {
                const content = generateGeographyMock(task.cat, task.itemIndex, task.variantCount);
                
                let finalOptions = content.options.map((text, idx) => ({ 
                    text, 
                    isCorrect: idx === content.correctIndex 
                }));
                finalOptions = fisherYatesShuffle(finalOptions);
                
                let correctIndices = [];
                finalOptions.forEach((opt, idx) => {
                    if (opt.isCorrect) correctIndices.push(idx);
                });

                const answerLabels = correctIndices.map(idx => String.fromCharCode(65 + idx)).join(', ');

                mocks.push({
                    id: `mock_geo_${startId + i}`,
                    type: 'single', 
                    category: content.category,
                    text: `[Q${startId + i}] ${content.text}`,
                    options: finalOptions.map(o => o.text),
                    correctAnswer: correctIndices,
                    explanation: `${content.explanation} (Á≠îÊ°à: ${answerLabels})`,
                    difficulty: ['Êòì', '‰∏≠', 'Èõ£'][Math.floor(Math.random() * 3)],
                    isReview: content.isReview,
                    colorClass: content.colorClass
                });
            });
            return mocks;
        };

        // -----------------------------------------------------------------------------
        // App Component
        // -----------------------------------------------------------------------------
        function GeographyApp() {
            const [currentScreen, setCurrentScreen] = useState('home'); 
            const [questions, setQuestions] = useState([]);
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [userAnswers, setUserAnswers] = useState({});
            const [markedQuestions, setMarkedQuestions] = useState(new Set()); 
            const [showExplanation, setShowExplanation] = useState(false);
            const [showGrid, setShowGrid] = useState(false); 

            useEffect(() => {
                let flattened = [];
                // ËôïÁêÜÁúüÂØ¶È°åÂ∫´
                REAL_QUESTION_EXAMPLES.forEach(item => {
                    if (item.type === 'group') {
                        item.questions.forEach(q => {
                            flattened.push({
                                ...q,
                                groupTitle: item.passageTitle,
                                groupContent: item.passageContent,
                                isGroup: true,
                                colorClass: "text-stone-700 bg-stone-100"
                            });
                        });
                    } else {
                        // Ê†πÊìöÈ°ûÂà•ÂàÜÈÖçÈ°èËâ≤
                        let color = "text-stone-700 bg-stone-100";
                        if(item.category.includes('Ëá™ÁÑ∂')) color = "text-emerald-700 bg-emerald-100";
                        if(item.category.includes('‰∫∫Êñá')) color = "text-orange-700 bg-orange-100";
                        if(item.category.includes('ÊäÄË°ì')) color = "text-indigo-700 bg-indigo-100";
                        
                        flattened.push({
                             ...item,
                             colorClass: color
                        });
                    }
                });

                const currentCount = flattened.length;
                const needed = 500 - currentCount;
                if (needed > 0) {
                    const mocks = generateMockQuestions(currentCount + 1, needed);
                    flattened = [...flattened, ...mocks];
                }

                setQuestions(flattened);
            }, []);

            const startExam = () => {
                setCurrentQuestionIndex(0);
                setUserAnswers({});
                setMarkedQuestions(new Set());
                setShowExplanation(false);
                setShowGrid(false);
                setCurrentScreen('quiz');
            };

            const handleAnswerSelect = (optionIndex) => {
                if (showExplanation) return; 
                const currentQ = questions[currentQuestionIndex];
                setUserAnswers(prev => ({ ...prev, [currentQ.id]: [optionIndex] }));
                setShowExplanation(true);
            };

            const toggleMarkQuestion = () => {
                const qId = questions[currentQuestionIndex].id;
                setMarkedQuestions(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(qId)) newSet.delete(qId);
                    else newSet.add(qId);
                    return newSet;
                });
            };

            const calculateScore = () => {
                let rawScore = 0;
                questions.forEach(q => {
                    const userAns = userAnswers[q.id] || [];
                    const correctAns = q.correctAnswer;
                    if (userAns.length > 0 && userAns[0] === correctAns[0]) {
                        rawScore++;
                    }
                });
                const percentage = (rawScore / questions.length) * 100;
                let rank = 0;
                if (percentage >= 90) rank = 15;
                else if (percentage >= 85) rank = 14;
                else if (percentage >= 80) rank = 13;
                else if (percentage >= 70) rank = 11;
                else if (percentage >= 60) rank = 9;
                else rank = Math.floor(percentage / 10) + 1;

                return { rawScore, total: questions.length, rank, percentage };
            };

            const QuestionGrid = ({ closeGrid }) => (
                <div className="fixed inset-0 bg-black/50 z-50 flex justify-end animate-fade-in">
                    <div className="w-full max-w-md bg-white h-full shadow-2xl flex flex-col animate-slide-in-right">
                        <div className="p-4 border-b flex justify-between items-center bg-stone-50">
                            <h3 className="font-bold text-lg text-stone-800 flex items-center font-serif">
                                <Icons.Grid size={20} className="mr-2 text-emerald-700"/> È°åÁõÆÂ∞éËà™
                            </h3>
                            <button onClick={closeGrid} className="p-2 hover:bg-stone-200 rounded-full transition">
                                <Icons.XCircle size={24} className="text-stone-500"/>
                            </button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 bg-stone-50">
                            <div className="grid grid-cols-5 gap-3">
                                {questions.map((qItem, idx) => {
                                    const isAnswered = userAnswers[qItem.id] && userAnswers[qItem.id].length > 0;
                                    const isMarkedItem = markedQuestions.has(qItem.id);
                                    const isCurrent = currentQuestionIndex === idx;
                                    let btnClass = "h-10 w-10 rounded-lg flex items-center justify-center text-sm font-medium transition relative font-serif ";
                                    if (isCurrent) btnClass += "ring-2 ring-emerald-600 ring-offset-2 bg-emerald-100 text-emerald-800 font-bold border-2 border-emerald-200 ";
                                    else if (isAnswered) btnClass += "bg-stone-600 text-white shadow-sm ";
                                    else btnClass += "bg-white border border-stone-200 text-stone-500 hover:bg-stone-100 ";

                                    return (
                                        <button 
                                            key={qItem.id} 
                                            onClick={() => { setCurrentQuestionIndex(idx); setShowExplanation(false); closeGrid(); }}
                                            className={btnClass}
                                        >
                                            {idx + 1}
                                            {isMarkedItem && <span className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white"></span>}
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );

            if (currentScreen === 'home') return (
                <div className="flex flex-col items-center justify-center h-full p-6 space-y-8 animate-fade-in bg-stone-100 bg-geo-pattern relative">
                    <div className="text-center space-y-4 max-w-lg z-10">
                        <div className="bg-emerald-700 p-6 rounded-3xl inline-block mb-2 shadow-xl transform rotate-3 hover:rotate-0 transition duration-500">
                            <Icons.Compass size={64} className="text-white" />
                        </div>
                        <h1 className="text-3xl font-extrabold text-stone-800 tracking-tight font-serif">108Ë™≤Á∂± ‚Ä¢ Âú∞ÁêÜÊé¢Á©∂</h1>
                        <p className="text-lg text-stone-600 font-medium">Ëá™ÁÑ∂ ‚Ä¢ ‰∫∫Êñá ‚Ä¢ ÂçÄÂüü ‚Ä¢ ÊäÄË°ì</p>
                        <div className="flex flex-wrap justify-center gap-2 mt-4">
                           <span className="px-3 py-1 bg-white border border-stone-300 rounded-full text-sm text-stone-600 shadow-sm">500È°åÂ∫´</span>
                           <span className="px-3 py-1 bg-white border border-stone-300 rounded-full text-sm text-stone-600 shadow-sm">ÂúñË°®Âà§ËÆÄ</span>
                           <span className="px-3 py-1 bg-white border border-stone-300 rounded-full text-sm text-stone-600 shadow-sm">ÊÉÖÂ¢ÉÁ¥†È§ä</span>
                        </div>
                    </div>
                    <div className="w-full max-w-sm z-10">
                        <button 
                            onClick={startExam}
                            className="w-full flex items-center justify-center p-5 bg-emerald-700 text-white rounded-xl shadow-lg hover:bg-emerald-800 transition transform hover:-translate-y-1 group font-serif border-b-4 border-emerald-900"
                        >
                            <div className="bg-white/20 p-2 rounded-full mr-3 group-hover:scale-110 transition">
                                <Icons.MapIcon size={24} className="text-white" />
                            </div>
                            <div className="text-left">
                                <span className="block font-bold text-xl">ÈñãÂßãÊ∏¨È©ó</span>
                                <span className="text-sm text-emerald-100">Geography Practice</span>
                            </div>
                        </button>
                    </div>
                    <div className="absolute bottom-0 w-full h-1 bg-gradient-to-r from-emerald-400 via-sky-500 to-emerald-400"></div>
                </div>
            );

            if (currentScreen === 'result') {
                const { rawScore, total, rank, percentage } = calculateScore();
                return (
                    <div className="flex flex-col items-center h-full bg-stone-100 p-6 overflow-y-auto font-serif">
                        <div className="w-full max-w-md space-y-6 mt-8">
                            <div className="bg-white rounded-3xl shadow-xl p-8 text-center relative overflow-hidden border-t-4 border-emerald-500">
                                <h2 className="text-3xl font-extrabold text-stone-800 mb-2">Ê∏¨È©óÁµêÊùü</h2>
                                <div className="flex justify-center my-8">
                                    <div className="text-6xl font-black text-emerald-700">{percentage.toFixed(0)}<span className="text-2xl text-stone-400 font-normal">ÂàÜ</span></div>
                                </div>
                                <div className="grid grid-cols-2 gap-4 text-left">
                                    <div className="bg-stone-50 p-4 rounded-2xl border border-stone-100">
                                        <p className="text-xs text-stone-500 font-bold mb-1">Á≠îÂ∞çÈ°åÊï∏</p>
                                        <p className="text-2xl font-bold text-stone-800">{rawScore} / {total}</p>
                                    </div>
                                    <div className="bg-stone-50 p-4 rounded-2xl border border-stone-100">
                                        <p className="text-xs text-stone-500 font-bold mb-1">ÊèõÁÆóÁ¥öÂàÜ</p>
                                        <p className="text-2xl font-bold text-stone-800">{rank}</p>
                                    </div>
                                </div>
                            </div>
                            <div className="space-y-3">
                                <button onClick={() => setCurrentScreen('home')} className="w-full bg-stone-700 hover:bg-stone-800 text-white py-4 rounded-2xl font-bold shadow-lg transition flex items-center justify-center space-x-2">
                                    <Icons.RotateCcw size={20} /> <span>ÈáçËøîÈ¶ñÈ†Å</span>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            const q = questions[currentQuestionIndex];
            if (!q) return <div className="flex items-center justify-center h-full text-xl font-serif text-stone-500">Âú∞ÂúñËºâÂÖ•‰∏≠...</div>;

            const currentAns = userAnswers[q.id] || [];
            const isMarked = markedQuestions.has(q.id);

            return (
                <div className="flex flex-col h-full bg-stone-50 relative font-sans">
                    {showGrid && <QuestionGrid closeGrid={() => setShowGrid(false)} />}
                    
                    <div className="bg-white shadow-sm px-4 py-3 flex justify-between items-center sticky top-0 z-10 border-b border-stone-200">
                        <div className="flex items-center space-x-3">
                            <button onClick={() => setCurrentScreen('home')} className="p-2 hover:bg-stone-100 rounded-lg text-stone-500 transition">
                                <Icons.Home size={20} />
                            </button>
                            <button onClick={() => setShowGrid(true)} className="flex items-center space-x-2 px-3 py-1.5 bg-stone-100 hover:bg-stone-200 rounded-lg transition text-stone-700 font-medium border border-stone-200">
                                <Icons.Grid size={18} />
                                <span>{currentQuestionIndex + 1} / {questions.length}</span>
                            </button>
                        </div>
                        <button onClick={toggleMarkQuestion} className={`p-2 rounded-lg transition ${isMarked ? 'bg-red-50 text-red-500' : 'text-stone-400 hover:bg-stone-100'}`}>
                            <Icons.Flag size={20} fill={isMarked ? "currentColor" : "none"} />
                        </button>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 md:p-6 max-w-4xl mx-auto w-full scroll-smooth">
                        {q.isGroup && (
                            <div className="bg-emerald-50 rounded-xl p-6 mb-6 shadow-sm border-l-4 border-emerald-600">
                                <div className="flex items-center justify-between mb-3">
                                    <h3 className="font-bold text-lg text-emerald-900 flex items-center">
                                        <Icons.MapIcon size={18} className="mr-2"/>
                                        {q.groupTitle}
                                    </h3>
                                    <span className="text-xs bg-white text-emerald-800 border border-emerald-200 px-2 py-1 rounded">È°åÁµÑ</span>
                                </div>
                                <div className="prose prose-stone max-w-none text-stone-800 leading-relaxed text-base">
                                    {q.groupContent}
                                </div>
                            </div>
                        )}

                        <div className="bg-white rounded-xl p-6 shadow-sm ring-1 ring-stone-200">
                            <div className="flex items-center space-x-2 mb-4">
                                <span className={`text-xs font-bold px-2 py-1 rounded bg-stone-200 text-stone-800`}>
                                    ÂñÆÈÅ∏È°å
                                </span>
                                <span className={`text-xs px-2 py-1 rounded border ${q.colorClass || 'text-gray-500 bg-gray-100 border-gray-200'}`}>
                                    {q.category}
                                </span>
                                {q.isReview && <span className="text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded border border-amber-200 flex items-center animate-pulse"><Icons.Tag size={12} className="mr-1" /> ËßÄÂøµË§áÁøí</span>}
                            </div>

                            <h2 className="text-xl font-medium text-stone-900 mb-8 leading-relaxed whitespace-pre-wrap">
                                {q.text}
                            </h2>

                            <div className="space-y-4">
                                {q.options.map((option, idx) => {
                                    const isSelected = currentAns.includes(idx);
                                    let btnClass = "w-full text-left p-4 rounded-xl border transition-all flex items-start space-x-4 relative overflow-hidden ";
                                    if (showExplanation) {
                                        if (q.correctAnswer.includes(idx)) btnClass += "border-emerald-500 bg-emerald-50 text-emerald-900";
                                        else if (isSelected) btnClass += "border-red-400 bg-red-50 text-red-900";
                                        else btnClass += "border-stone-100 text-stone-400 opacity-60";
                                    } else {
                                        if (isSelected) btnClass += "border-stone-600 bg-stone-100 text-stone-900 shadow-md";
                                        else btnClass += "border-stone-200 hover:border-emerald-400 hover:bg-emerald-50 text-stone-700";
                                    }

                                    return (
                                        <button key={idx} onClick={() => handleAnswerSelect(idx)} className={btnClass} disabled={showExplanation}>
                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 text-sm font-bold border transition-colors ${
                                                isSelected ? 'bg-stone-700 border-stone-700 text-white' : 'border-stone-300 text-stone-500'
                                            } ${showExplanation && q.correctAnswer.includes(idx) ? '!bg-emerald-600 !border-emerald-600 !text-white' : ''}`}>
                                                {String.fromCharCode(65 + idx)}
                                            </div>
                                            <span className="pt-1 text-lg">{option}</span>
                                        </button>
                                    );
                                })}
                            </div>

                            {showExplanation && (
                                <div className="mt-8 bg-sky-50 p-5 rounded-xl border border-sky-100 animate-fade-in">
                                    <div className="flex items-center space-x-2 text-sky-900 font-bold mb-3">
                                        <Icons.Award size={20} />
                                        <span>Ëß£Êûê</span>
                                    </div>
                                    <p className="text-sky-900 leading-relaxed">{q.explanation}</p>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="bg-white border-t border-stone-200 p-4 flex justify-between items-center safe-area-bottom">
                        <button 
                            onClick={() => { setShowExplanation(false); setCurrentQuestionIndex(prev => Math.max(0, prev - 1)); }}
                            disabled={currentQuestionIndex === 0}
                            className="flex items-center space-x-2 px-4 py-2 rounded-full text-stone-600 hover:bg-stone-100 disabled:opacity-30 transition"
                        >
                            <Icons.ChevronLeft size={20} /> <span>‰∏ä‰∏ÄÈ°å</span>
                        </button>
                        
                        <button 
                            onClick={() => {
                                if (currentQuestionIndex < questions.length - 1) { setShowExplanation(false); setCurrentQuestionIndex(prev => prev + 1); } 
                                else { setCurrentScreen('result'); setShowGrid(false); }
                            }}
                            className="bg-emerald-700 hover:bg-emerald-800 text-white px-8 py-2.5 rounded-full font-bold shadow-md flex items-center transition"
                        >
                            {currentQuestionIndex === questions.length - 1 ? 'ÂÆåÊàê' : '‰∏ã‰∏ÄÈ°å'} <Icons.ChevronRight size={18} className="ml-1"/>
                        </button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GeographyApp />);
    </script>
</body>
</html>